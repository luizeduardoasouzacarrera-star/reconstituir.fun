import { db } from "./firebase.js";
import {
  collection,
  addDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

async function logVisit() {
  try {
    if (sessionStorage.getItem("visit_logged")) return;
    sessionStorage.setItem("visit_logged", "1");

    // ðŸ”¥ IP REAL (sem CORS, sem token)
    const ipRes = await fetch("https://api.ipify.org?format=json");
    const ipData = await ipRes.json();

    await addDoc(collection(db, "visits"), {
      ip: ipData.ip,
      userAgent: navigator.userAgent,
      page: window.location.pathname,
      createdAt: serverTimestamp()
    });

    console.log("Visita registrada:", ipData.ip);

  } catch (e) {
    console.error("Erro ao registrar visita:", e);
  }
}

logVisit();
